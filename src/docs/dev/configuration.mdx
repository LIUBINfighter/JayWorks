---
id: configuration
title: 配置与使用说明
description: 说明如何通过 navigation.ts 与 frontmatter 管理分组、分类、排序与草稿隐藏。
updated: 2025-09-27
tags: [config, navigation, docs]
---

import { Notice } from '../components/registry-placeholder'; // 占位示例：如果需要使用 React 组件，确保已在 registry 映射

> 本文档描述当前内置文档 SPA 的配置面。涵盖 `NAV_GROUPS`、分类(category)、`draft`、frontmatter 字段、Footer 扩展及常见调试流程。

## 快速概览

| 维度 | 配置位置 | 作用 | 备注 |
| ---- | -------- | ---- | ---- |
| 顶部分组 | `navigation.ts` `NAV_GROUPS[].id/label` | 顶部导航切换上下文 | 顺序决定显示顺序 |
| 文档注册 | `NAV_GROUPS[].items[]` | 决定侧边栏与全局顺序 | 仅显式列出的会出现 |
| 分类 Category | `type: 'category'` | 将同类文档折叠分组 | `defaultId` 指定点击分类后打开的文档 |
| 草稿隐藏 | `draft: true` | 隐藏该文档或分类 | registry 解析时直接跳过 |
| 文档元信息 | MDX frontmatter | 标题/描述/标签/更新时间 | 优先级高于 navigation 里同名显示属性 |
| 跨组分页 | 自动 (registry 顺序) | Prev/Next 连通首尾 | 按 `NAV_GROUPS` 外层顺序序列化 |
| Footer 扩展 | `footerWidgets.tsx` | 增加/替换底部信息 | 通过 `registerFooterWidget` |

## 1. 定义导航 (navigation.ts)

核心结构：

```ts
export const NAV_GROUPS: NavGroup[] = [
  {
    id: 'demo',
    label: 'Demo',
    items: [
      { id: 'demo', file: 'demo/demo.mdx', label: '示例文档' },
      { id: 'example', file: 'demo/example.mdx', label: '第二篇示例' },
    ],
  },
  {
    id: 'dev',
    label: 'Dev',
    items: [
      { id: 'unified-plan', file: 'dev/unified-plan.mdx', label: '渲染管线设计' },
      {
        type: 'category',
        id: 'style-guide',
        label: 'Style Guide',
        defaultId: 'style-guide',
        items: [
          { id: 'style-guide', file: 'dev/style-guide/readme.mdx', label: '概览' },
          { id: 'style-guide-obsidian', file: 'dev/style-guide/obsidian.mdx', label: 'Obsidian 风格' },
        ]
      },
      { id: 'frontformatter-schema', file: 'dev/frontformatter-schema.mdx', label: 'Frontmatter Schema' }
    ],
  },
];
```

### 1.1 分组 (Group)
- `id` 唯一且稳定；分页、状态恢复依赖它。
- `label` 顶部显示名称。
- 数组顺序决定全局遍历顺序（影响跨组分页 Prev/Next）。

### 1.2 文档 (Doc Item)
字段 | 说明
----- | ----
`id` | 唯一标识；应与文件主题语义相关
`file` | 便于人工核对的相对路径（未用于运行时加载，因为已静态 import）
`label` | 覆盖侧边栏显示文本（若缺省，使用 frontmatter.title）
`draft` | 为 true 时该条不加入 registry，也不出现在侧边栏与分页序列

### 1.3 分类 (Category)
字段 | 说明
----- | ----
`type: 'category'` | 区分类别与单文档
`id` | 分类自身 ID，可与默认文档 id 相同
`label` | 侧边栏显示文案
`items` | 仅包含 doc item（不再嵌套 category，若将来需要可递归扩展）
`defaultId` | 点击分类行时自动打开的文档；未设置时取第一个可见 doc
`collapsed` | 初始是否折叠（默认 false）
`draft` | 整个分类隐藏

行为：点击分类
a) 打开 `defaultId` 或第一个非 draft 子文档
b) 切换折叠状态

## 2. Frontmatter 字段

目前支持字段（与 `frontformatter-schema` 文档同步）：

字段 | 类型 | 作用
---- | ---- | ----
`title` | string | 页面主标题，侧边栏回退显示名称
`description` | string | 标题下副文本（摘要）
`tags` | string \| string[] | 标签集合（当前仅展示层面预留）
`date` | string/date | 初始日期（ISO 或可被 `Date` 解析）
`updated` | string/date | 覆盖最终更新时间，将被规范化为时间戳
`navLabel` | string | 强制覆盖侧边栏与分页里的显示文本（优先级高于 navigation.label）
`draft` | boolean | 若为 true（即使在 navigation 中声明），仍会被过滤

> 解析策略：`updated` / `date` 优先级 — 若 `updated` 存在使用它，否则使用 `date`。解析成功后保存到 `meta.updated`（毫秒时间戳）。

### 2.1 示例

```mdx
---
title: 自定义渲染管线
description: 介绍统一的 remark/rehype 组合与安全过滤策略。
tags: [mdx, pipeline]
updated: 2025-09-26
navLabel: 渲染管线设计
---

正文内容...
```

## 3. 草稿 (draft) 策略

来源 | 作用范围 | 规则
---- | -------- | ----
`navigation.ts` doc/category `draft: true` | 该条目完全不注册 | 直接跳过
frontmatter `draft: true` | 文件级隐藏 | 即使出现在 navigation 也会被过滤

> 双重保险：一个标记为 draft 的文档无法通过 Prev/Next 被访问。

## 4. 全局顺序与分页

1. 先按 `NAV_GROUPS` 外层数组顺序遍历所有 group。
2. 针对每个 group，按其 `items` 顺序展开 doc；遇到 category 则按 category.items 顺序加入。
3. 过滤所有 draft（无论 navigation 还是 frontmatter）。
4. 得到一个线性列表：用于分页上下文与阅读时长统计遍历。

这样设计保证：
- 分组内部顺序可控；
- 分组之间跨越安全可预测；
- 新增文档只需在 navigation 正确位置插入即可。

## 5. Footer 扩展点

在 `footerWidgets.tsx` 中：
```ts
registerFooterWidget({
  id: 'custom',
  order: 5,
  align: 'left',
  when: ctx => !!ctx.doc,
  render: ctx => <span>自定义内容</span>
});
```
字段 | 说明
---- | ----
`order` | 数值越小越靠左（同一 align 内）
`align` | `left` | `center` | `right`
`when` | 返回 false 则不渲染
`render` | 返回 React 节点

## 6. 调试与常见问题

场景 | 现象 | 排查建议
---- | ---- | ----
新增文档不显示 | 侧边栏缺失 | 是否忘记在 `navigation.ts` import & 加入 `MDX_SOURCES` 与 `NAV_GROUPS`?
分页跳过文档 | 文档无法通过 Prev/Next 命中 | 检查是否 `draft: true`
标题未更新 | 仍显示旧 label | 是否被 `navLabel` 或 navigation.label 覆盖？
更新时间不变 | Footer 中未刷新 | 修改 frontmatter 后需重新构建（当前为静态打包）

## 7. 未来扩展（规划）
- 版本化（versions.json 驱动多版本 docs）
- i18n（基于 group 或前缀 locale 分桶）
- 搜索（建立轻量 inverted index）
- Live reload（开发时监听 MDX 变更热替换）

## 8. 最佳实践速览

- 先在 `navigation.ts` 里规划结构，再创建 MDX 文件，避免孤儿文档。
- 批量移动文档后逐一核对 `file` 值（防止语义漂移）。
- 使用 `navLabel` 做短标签，不直接修改正式标题 `title`。
- 初稿加 `draft: true`，准备发布时删掉；避免频繁改 navigation 顺序影响分页稳定性。

---
如有新增字段，请同步更新：`frontformatter-schema.mdx` 与本篇对应章节。
