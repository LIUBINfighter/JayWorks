---
title: 文档版本与别名
description: 轻量版本化策略与操作指南
order: 90
---

# 文档版本与别名

本插件采用 **轻量别名驱动** 的版本化模型，适合版本数量极少（&lt;=5）的场景。

## 核心概念

| 概念 | 说明 |
|------|------|
| snapshot | 真实的快照版本号，例如 `3.2.1` / `3.2.x-beta` |
| alias | 指向快照的别名，如 `latest` / `next` / `v2` |
| track (major) | 主版本线编号（1、2、3...）|

`version-manifest.json` 保存 alias → snapshot 的映射。

## 目录建议

```
src/docs/               # 当前 latest 快照内容（或 stable）
src/docs_beta/          # （可选）next/beta 内容
src/docs/archived/v2/   # v2 最终快照
src/docs/archived/v1/   # v1 最终快照
```

（当前实现尚未自动扫描 archived 目录；后续可按需要扩展为多来源 Provider。）

## version-manifest.json 示例

```json
{
  "aliases": {
    "latest": "3.2.1",
    "next": "3.2.x-beta",
    "v2": "2.5.3",
    "v1": "1.8.2"
  },
  "tracks": [
    { "major": 3, "snapshot": "3.2.1", "stable": true },
    { "major": 2, "snapshot": "2.5.3", "stable": true }
  ]
}
```

## 升级流程（含 beta → stable）

1. 完成 beta 内容（`next` alias 指向 `3.2.x-beta`）。
2. 发布新稳定版：更新 `aliases.latest = 3.3.0`（假设新版本）。
3. 将旧稳定快照（`3.2.1`）如需要归档：添加 `aliases.v3 = 3.2.1` 或忽略（视需求）。
4. 若继续新一轮 beta：新增 `aliases.next = 3.3.x-beta`；否则移除 `next` 或设为 null。
5. 保存并重载插件。

## 运行时行为

- `versionedRegistry` 包装基础 `docRegistry`，当前仅把所有内置文档视为同一快照（`aliases.latest`）。
- 通过 `versionedRegistry.setActiveAlias(alias)` 切换视角。
- 返回的 `DocRecord.meta` 会自动补充：`version`、`alias`、`track`、`isPreRelease`。

## 后续扩展思路

| 方向 | 说明 |
|------|------|
| 多来源扫描 | 自动加载 archived 目录多版本内容 |
| i18n 结合 | (alias, locale) 双维度聚合 |
| 版本对比 | AST diff 展示变更摘要 |
| 搜索隔离 | 每个 alias 单独索引，按需构建 |

---

如需添加脚本自动维护 manifest，可在 `scripts/` 下增加一个小工具读取 `package.json` 版本并更新 `aliases.latest`。
